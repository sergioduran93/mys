;(function($) {

    $.JCombo = function(element, options, callback) {

		//Variables por defecto
        var defaults = {
            data      : null,
			nodeId    : '',
			parentId  : ''
        };

		//MÃ©todos por defecto
		var methods = {
			onSelect : function() {},
			onFinished  : function() {}
        };

		//
        var widget      = this;
        widget.settings = {};
		widget.callback = {};

		var $element    = $(element);

		//M?todo que inicializa los elementos del plugin
        widget.init = function() {
            widget.settings = $.extend({}, defaults, options);
			widget.settings.findCounter = widget.settings.data.length;

			widget.callback = $.extend({}, methods, callback);
			setHtmlSelect();
			installListener();
        };

		//Agrega las im?genes al elemento seleccionado
        var setHtmlSelect = function() {
			var parentId = widget.settings.parentId;
			$('#'+parentId).find('option').remove();
			$('#'+parentId).append('<option value></option>');

			$.each(widget.settings.data, function(key, value) {
				$('#'+parentId).append('<option value="'+value.id+'">'+value.value+'</option>');
			});
        };

		var installListener = function(){
			var parentId = widget.settings.parentId;

			$('#'+parentId).change(function(event) {
				var selected = $(this).val();
				var subData = getSubData(selected);

				var nodeId = widget.settings.nodeId;
				$('#'+nodeId).find('option').remove();
				$('#'+nodeId).append('<option value></option>');

				$.each(subData, function(key, value) {
					$('#'+nodeId).append('<option value="'+key+'">'+value+'</option>');
				});
				eachChange();
			});
		};

		var getSubData = function(id){
			var subData = null;
			$.each(widget.settings.data, function(key, element) {
				if(element.id == id){
					subData = element.SubData;
				}
			});
			return subData;
		};

		//
        widget.init();
    };

	//Init
    $.fn.JCombo = function(options, callback) {
        return this.each(function() {
            if (undefined == $(this).data('JCombo')) {
                var widget = new $.JCombo(this, options, callback);
                $(this).data('JCombo', widget);
            }
        });
    };

})(jQuery);

function eachChange() {
	// crear esta misma funcion en la vista, eachChange()
}